<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar data-theme="dark" class="astro-vvohquby"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>TLA+ AI Linter | GenAIScript</title><link rel="canonical" href="https://microsoft.github.io/genaiscript/case-studies/tla-ai-linter/"/><link rel="sitemap" href="/genaiscript/sitemap-index.xml"/><link rel="shortcut icon" href="/genaiscript/images/favicon.png" type="image/png"/><meta name="generator" content="Astro v4.5.3"/><meta name="generator" content="Starlight v0.21.1"/><meta property="og:title" content="TLA+ AI Linter"/><meta property="og:type" content="article"/><meta property="og:url" content="https://microsoft.github.io/genaiscript/case-studies/tla-ai-linter/"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="GenAIScript"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="TLA+ AI Linter"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/genaiscript/_astro/index.DovFo1oE.css" />
<style>svg:where(.astro-hq73xlw2){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
</style><script type="module" src="/genaiscript/_astro/hoisted.D968lKcP.js"></script>
<script type="module" src="/genaiscript/_astro/page.CZ0TFQCk.js"></script><style>.card-grid:where(.astro-tggg5lbc){display:grid;gap:1rem}.card-grid:where(.astro-tggg5lbc)>*{margin-top:0!important}@media (min-width: 50rem){.card-grid:where(.astro-tggg5lbc){grid-template-columns:1fr 1fr;gap:1.5rem}.stagger:where(.astro-tggg5lbc){--stagger-height: 5rem;padding-bottom:var(--stagger-height)}.stagger:where(.astro-tggg5lbc)>*:nth-child(2n){transform:translateY(var(--stagger-height))}}
</style><style>.card:where(.astro-iebqbg2o){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-iebqbg2o):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-iebqbg2o):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-iebqbg2o):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-iebqbg2o):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-iebqbg2o){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-iebqbg2o) .icon:where(.astro-iebqbg2o){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem}.card:where(.astro-iebqbg2o) .body:where(.astro-iebqbg2o){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}
</style><style>starlight-file-tree:where(.astro-7ll2nywl){--x-space: 1.5rem;--y-space: .125rem;--y-pad: 0;display:block;border:1px solid var(--sl-color-gray-5);padding:1rem;background-color:var(--sl-color-gray-6);font-size:var(--sl-text-xs);font-family:var(--__sl-font-mono);overflow-x:auto}starlight-file-tree:where(.astro-7ll2nywl) .directory>details{border:0;padding:0;padding-inline-start:var(--x-space);background:transparent}starlight-file-tree:where(.astro-7ll2nywl) .directory>details>summary{margin-inline-start:calc(-1 * var(--x-space));border:0;padding:var(--y-pad) .625rem;font-weight:400;color:var(--sl-color-white);max-width:100%;&::marker,&::-webkit-details-marker{color:var(--sl-color-gray-3)}&:hover,&:hover .tree-icon{cursor:pointer;color:var(--sl-color-text-accent);fill:var(--sl-color-text-accent);~ul{border-color:var(--sl-color-gray-4)}}&:hover .highlight .tree-icon{fill:var(--sl-color-text-invert)}}starlight-file-tree:where(.astro-7ll2nywl) ul{margin-inline-start:.5rem;border-inline-start:1px solid var(--sl-color-gray-5);padding:0;padding-inline-start:.125rem;list-style:none}starlight-file-tree:where(.astro-7ll2nywl)>ul{margin:0;border:0;padding:0}starlight-file-tree:where(.astro-7ll2nywl) li{margin:var(--y-space) 0;padding:var(--y-pad) 0}starlight-file-tree:where(.astro-7ll2nywl) .file{margin-inline-start:calc(var(--x-space) - .125rem);color:var(--sl-color-white)}starlight-file-tree:where(.astro-7ll2nywl) .tree-entry{display:inline-flex;align-items:flex-start;flex-wrap:wrap;max-width:calc(100% - 1rem);@media (min-width: 30em){flex-wrap:nowrap}>:first-child{flex-shrink:0}}starlight-file-tree:where(.astro-7ll2nywl) .empty{color:var(--sl-color-gray-3);padding-inline-start:.375rem}starlight-file-tree:where(.astro-7ll2nywl) .comment{color:var(--sl-color-gray-3);padding-inline-start:1.625rem;max-width:24rem;min-width:12rem}starlight-file-tree:where(.astro-7ll2nywl) .highlight{display:inline-block;border-radius:.25rem;padding-inline-end:.5rem;color:var(--sl-color-text-invert);background-color:var(--sl-color-text-accent)}starlight-file-tree:where(.astro-7ll2nywl) svg{display:inline;fill:var(--sl-color-gray-3);vertical-align:middle;margin-inline:.25rem .375rem;width:.875rem;height:.875rem}starlight-file-tree:where(.astro-7ll2nywl) .highlight svg.tree-icon{fill:var(--sl-color-text-invert)}
</style><style>.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;padding-inline-start:0}.sl-steps>li{position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(list-item);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:not(:last-of-type):after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}
</style><style>starlight-tabs:where(.astro-3ja6w76o){display:block}.tablist-wrapper:where(.astro-3ja6w76o){overflow-x:auto}:where(.astro-3ja6w76o)[role=tablist]{display:flex;list-style:none;border-bottom:2px solid var(--sl-color-gray-5);padding:0}.tab:where(.astro-3ja6w76o){margin-bottom:-2px}.tab:where(.astro-3ja6w76o)>:where(.astro-3ja6w76o)[role=tab]{display:flex;align-items:center;gap:.5rem;padding:0 1.25rem;text-decoration:none;border-bottom:2px solid var(--sl-color-gray-5);color:var(--sl-color-gray-3);outline-offset:var(--sl-outline-offset-inside)}.tab:where(.astro-3ja6w76o) :where(.astro-3ja6w76o)[role=tab][aria-selected]{color:var(--sl-color-white);border-color:var(--sl-color-text-accent);font-weight:600}.tablist-wrapper:where(.astro-3ja6w76o)~[role=tabpanel]{margin-top:1rem}
</style><script src="/genaiscript/_astro/Tabs.astro_astro_type_script_index_0_lang.BqK4QFew.js" type="module"></script></head> <body class="astro-vvohquby"> <a href="#_top" class="astro-5skvd5ra">Skip to content</a>  <div class="page sl-flex astro-kz3bx6v6"> <header class="header astro-kz3bx6v6"><div class="header sl-flex astro-mebrli7u"> <div class="title-wrapper sl-flex astro-mebrli7u"> <a href="/genaiscript/" class="site-title sl-flex astro-mai6nhnx">  <img class="astro-mai6nhnx" alt="" src="/genaiscript/_astro/logo.C7y7Xksc.svg" width="630" height="630">  <span class="astro-mai6nhnx"> GenAIScript </span> </a>  </div> <div class="sl-flex astro-mebrli7u"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-ccmpdn3u"> <button data-open-modal disabled class="astro-ccmpdn3u">  <svg aria-label="Search" class="astro-ccmpdn3u astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-ccmpdn3u" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-ccmpdn3u astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-ccmpdn3u"> <div class="dialog-frame sl-flex astro-ccmpdn3u">  <button data-close-modal class="sl-flex md:sl-hidden astro-ccmpdn3u"> Cancel </button> <div class="search-container astro-ccmpdn3u"> <div id="starlight__search" class="astro-ccmpdn3u"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-mebrli7u"> <div class="sl-flex social-icons astro-mebrli7u"> <a href="https://github.com/microsoft/genaiscript" rel="me" class="sl-flex astro-feya7u7g"><span class="sr-only astro-feya7u7g">GitHub</span><svg aria-hidden="true" class="astro-feya7u7g astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-7x63hbvd"> <span class="sr-only astro-7x63hbvd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-7x63hbvd astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-7x63hbvd"> <option value="dark" class="astro-7x63hbvd">Dark</option><option value="light" class="astro-7x63hbvd">Light</option><option value="auto" selected="true" class="astro-7x63hbvd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-7x63hbvd astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-kz3bx6v6" aria-label="Main"> <starlight-menu-button class="astro-phtkm5vv"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-phtkm5vv"> <svg aria-hidden="true" class="astro-phtkm5vv astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-kz3bx6v6"> <div class="sidebar-content sl-flex astro-kz3bx6v6"> <ul class="top-level astro-iulsnci3"> <li class="astro-iulsnci3"> <details open class="astro-iulsnci3"> <summary class="astro-iulsnci3"> <div class="group-label astro-iulsnci3"> <span class="large astro-iulsnci3">Start Here</span>  </div> <svg aria-hidden="true" class="caret astro-iulsnci3 astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-iulsnci3"> <li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Getting Started</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/installation/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Installation</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/configuration/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Configuration</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/your-first-genai-script/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Your first GenAI script</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/running-scripts/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Running scripts</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/debugging-scripts/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Debugging Scripts</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/getting-started/automating-scripts/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Automating scripts</span>  </a> </li> </ul>  </details> </li><li class="astro-iulsnci3"> <details open class="astro-iulsnci3"> <summary class="astro-iulsnci3"> <div class="group-label astro-iulsnci3"> <span class="large astro-iulsnci3">Case Studies</span>  </div> <svg aria-hidden="true" class="caret astro-iulsnci3 astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-iulsnci3"> <li class="astro-iulsnci3"> <a href="/genaiscript/case-studies/bicep-best-practices/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Bicep Best Practices</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/case-studies/seo-frontmatter/" class="astro-iulsnci3"> <span class="astro-iulsnci3">SEO Front Matter</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/case-studies/documentation-translations/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Documentation Translations</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/case-studies/blocks-localization/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Blocks Localization</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/case-studies/tla-ai-linter/" aria-current="page" class="astro-iulsnci3"> <span class="astro-iulsnci3">TLA+ AI Linter</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/case-studies/image-alt-text/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Image Alt Text</span>  </a> </li> </ul>  </details> </li><li class="astro-iulsnci3"> <details open class="astro-iulsnci3"> <summary class="astro-iulsnci3"> <div class="group-label astro-iulsnci3"> <span class="large astro-iulsnci3">Guides</span>  </div> <svg aria-hidden="true" class="caret astro-iulsnci3 astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-iulsnci3"> <li class="astro-iulsnci3"> <a href="/genaiscript/guides/ask-my-pdf/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Ask My PDF</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/guides/ask-my-image/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Ask My Image</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/guides/present-my-code/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Present My Code</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/guides/generated-knowledge/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Generated Knowledge</span>  </a> </li> </ul>  </details> </li><li class="astro-iulsnci3"> <details open class="astro-iulsnci3"> <summary class="astro-iulsnci3"> <div class="group-label astro-iulsnci3"> <span class="large astro-iulsnci3">Reference</span>  </div> <svg aria-hidden="true" class="caret astro-iulsnci3 astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-iulsnci3"> <li class="astro-iulsnci3"> <a href="/genaiscript/reference/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Overview</span>  </a> </li><li class="astro-iulsnci3"> <details open class="astro-iulsnci3"> <summary class="astro-iulsnci3"> <div class="group-label astro-iulsnci3"> <span class="large astro-iulsnci3">scripts</span>  </div> <svg aria-hidden="true" class="caret astro-iulsnci3 astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-iulsnci3"> <li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Overview</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/metadata/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Metadata</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/prompt/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Prompt ($)</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/context/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Context (def)</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/variables/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Variables</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/schemas/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Data Schemas</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/functions/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Functions</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/docx/" class="astro-iulsnci3"> <span class="astro-iulsnci3">DOCX</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/pdf/" class="astro-iulsnci3"> <span class="astro-iulsnci3">PDF</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/embeddings-search/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Embeddings Search</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/images/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Images</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/inline-prompts/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Inline prompts</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/retreival/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Retreival</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/system/" class="astro-iulsnci3"> <span class="astro-iulsnci3">System Prompts</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/annotations/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Annotations</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/code-outline/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Code Outline</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/file-merge/" class="astro-iulsnci3"> <span class="astro-iulsnci3">File Merge</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/custom-output/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Custom Output</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/json-mode/" class="astro-iulsnci3"> <span class="astro-iulsnci3">JSON Mode</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/parsers/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Parsers</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/files/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Files</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/fetch/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Fetch</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/web-search/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Web Search</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/secrets/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Secrets</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/yaml/" class="astro-iulsnci3"> <span class="astro-iulsnci3">YAML</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/csv/" class="astro-iulsnci3"> <span class="astro-iulsnci3">CSV</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/ini/" class="astro-iulsnci3"> <span class="astro-iulsnci3">INI</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/response-priming/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Reponse Priming</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/specs/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Specs</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/scripts/aici/" class="astro-iulsnci3"> <span class="astro-iulsnci3">AICI</span>  </a> </li> </ul>  </details> </li><li class="astro-iulsnci3"> <details open class="astro-iulsnci3"> <summary class="astro-iulsnci3"> <div class="group-label astro-iulsnci3"> <span class="large astro-iulsnci3">cli</span>  </div> <svg aria-hidden="true" class="caret astro-iulsnci3 astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-iulsnci3"> <li class="astro-iulsnci3"> <a href="/genaiscript/reference/cli/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Overview</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/cli/run/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Run</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/cli/batch/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Batch</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/cli/commands/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Commands</span>  </a> </li> </ul>  </details> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/token/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Authorization</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/security-and-trust/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Security and Trust</span>  </a> </li><li class="astro-iulsnci3"> <a href="/genaiscript/reference/transparency-note/" class="astro-iulsnci3"> <span class="astro-iulsnci3">Transparency Note</span>  </a> </li> </ul>  </details> </li><li class="astro-iulsnci3"> <a href="/genaiscript/faq" class="large astro-iulsnci3"> <span class="astro-iulsnci3">FAQ</span>  </a> </li><li class="astro-iulsnci3"> <a href="https://github.com/microsoft/genaiscript/blob/main/CONTRIBUTING.md" class="large astro-iulsnci3"> <span class="astro-iulsnci3">Contributing</span>  </a> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-vyybnkhj"> <div class="sl-flex social-icons astro-vyybnkhj"> <a href="https://github.com/microsoft/genaiscript" rel="me" class="sl-flex astro-feya7u7g"><span class="sr-only astro-feya7u7g">GitHub</span><svg aria-hidden="true" class="astro-feya7u7g astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-7x63hbvd"> <span class="sr-only astro-7x63hbvd">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-7x63hbvd astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-7x63hbvd"> <option value="dark" class="astro-7x63hbvd">Dark</option><option value="light" class="astro-7x63hbvd">Light</option><option value="auto" selected="true" class="astro-7x63hbvd">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-7x63hbvd astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-kz3bx6v6">  <div class="lg:sl-flex astro-ywt7ojlk"> <aside class="right-sidebar-container astro-ywt7ojlk"> <div class="right-sidebar astro-ywt7ojlk"> <div class="lg:sl-hidden astro-2lr6tkbl"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-w42hprsb"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-w42hprsb"><details id="starlight__mobile-toc" class="astro-w42hprsb"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-w42hprsb"><div class="toggle sl-flex astro-w42hprsb">On this page<svg aria-hidden="true" class="caret astro-w42hprsb astro-hq73xlw2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-w42hprsb"></span></summary><div class="dropdown astro-w42hprsb"><ul class="isMobile astro-qiskonrd" style="--depth: 0;"> <li class="astro-qiskonrd" style="--depth: 0;"> <a href="#_top" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#tla-specifications" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">TLA+ specifications</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#script" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Script</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#github-action" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Github Action</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#results" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Results</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-2lr6tkbl"><div class="sl-container astro-2lr6tkbl"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-qiskonrd" style="--depth: 0;"> <li class="astro-qiskonrd" style="--depth: 0;"> <a href="#_top" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#tla-specifications" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">TLA+ specifications</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#script" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Script</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#github-action" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Github Action</span> </a>  </li><li class="astro-qiskonrd" style="--depth: 0;"> <a href="#results" class="astro-qiskonrd" style="--depth: 0;"> <span class="astro-qiskonrd" style="--depth: 0;">Results</span> </a>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-ywt7ojlk">  <main data-pagefind-body lang="en" dir="ltr" class="astro-vvohquby">    <div class="content-panel astro-5hfwsorh"> <div class="sl-container astro-5hfwsorh"> <h1 id="_top" class="astro-yqz6ib4w">TLA+ AI Linter</h1>  </div> </div>  <div class="content-panel astro-5hfwsorh"> <div class="sl-container astro-5hfwsorh"> <div class="sl-markdown-content"> <p><a href="https://lamport.azurewebsites.net/tla/tla.html">TLA+</a> is a high-level language for modeling programs and systems—especially
concurrent and distributed ones.  It’s based on the idea that the best way to describe things precisely is with simple mathematics.</p>
<p>TLA+ does not come with a traditional linter or formatter.  The TLA+ AI Linter is a GenAI script that uses LLMs to lint TLA+ files.</p>
<h2 id="tla-specifications">TLA+ specifications</h2>
<p>The following is a TLA+ spec that models a seminal solution to the <a href="https://www.cs.utexas.edu/users/EWD/ewd09xx/EWD998.PDF">termination detection problem in distributed systems</a>.</p>
<div class="expressive-code"><link rel="stylesheet" href="/genaiscript/_astro/ec.pjkke.css"><script type="module" src="/genaiscript/_astro/ec.sgewm.js"></script><figure class="frame has-title not-content"><figcaption class="header"><span class="title">EWD998PCal.tla</span></figcaption><pre tabindex="0" class="wrap" style="--ecMaxLine:183ch"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">------------------------------- MODULE EWD998PCal -------------------------------</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(***************************************************************************)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(* TLA+ specification of an algorithm for distributed termination          *)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(* detection on a ring, due to Shmuel Safra, published as EWD 998:         *)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(* Shmuel Safra's version of termination detection.                        *)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(* https://www.cs.utexas.edu/users/EWD/ewd09xx/EWD998.PDF                  *)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(***************************************************************************)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">EXTENDS Integers, Bags, BagsExt</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">CONSTANT N</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ASSUME NAssumption == N \in Nat \ {0} \* At least one node.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">Node == 0 .. N-1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">Initiator == 0 \* Any node can be the initiator; 0 has just been conveniently choosen to simplify the definition of token initiation.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(********</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">--algorithm ewd998 {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">variables</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">(*</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">Although we know the relationship between the counter and network, modeling network as a set of messages would be too cumbersome.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">We have two alternatives for modeling the network: as a bag of messages or as a sequence of messages. Although modeling it as a</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">sequence may seem more intuitive, we do not require its ordering properties for our purposes. Therefore, we have decided to use a</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bag to represent the network. It's worth noting that Distributed Plucal refers to this concept as a "channel".</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">*)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">network = [n \in Node |-> IF n = Initiator THEN SetToBag({[type|-> "tok", q |-> 0, color |-> "black"]}) ELSE EmptyBag];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">define {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">(*</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">The passMsg operator is not implementable -at least not without using extra synchronization- because it atomically reads a message</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">from the nic's in-buffer and writes to its out-buffer!</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">*)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">passMsg(net, from, oldMsg, to, newMsg) == [ net EXCEPT ![from] = BagRemove(@, oldMsg), ![to] = BagAdd(@, newMsg) ]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">sendMsg(net, to, msg) == [ net EXCEPT ![to] = BagAdd(@, msg) ]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">dropMsg(net, to, msg) == [ net EXCEPT ![to] = BagRemove(@, msg) ]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">pendingMsgs(net, rcv) == DOMAIN net[rcv]</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">fair process (node \in Node)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">variables active \in BOOLEAN, color = "black", counter = 0;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">{</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">l:  while (TRUE) {</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">either { \* send some payload message to some other node.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">when active;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">with (to \in Node \ {self}) {</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">          </span></span><span style="--0:#d6deeb;--1:#403f53">network := sendMsg(network, to, [type|-> "pl"]);</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">};</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">counter := counter + 1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">} or { \* receive a payload message. Reactivates the node.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">with (msg \in pendingMsgs(network, self)) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">when msg.type = "pl";</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">counter := counter - 1;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">active := TRUE;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">color := "black";</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">network := dropMsg(network, self, msg)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">} or { \* terminate the current node.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">active := FALSE</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">} or { \* pass the token to the next node.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">when self # Initiator;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">with (tok \in pendingMsgs(network, self)) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">when tok.type = "tok" /\ ~active;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">network := passMsg(network, self, tok, self-1, [type|-> "tok", q |-> tok.q + counter, color |-> (IF color = "black" THEN "black" ELSE tok.color)]);</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">color := "white";</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">} or { \* Initiate token.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">when self = Initiator;</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">with (tok \in pendingMsgs(network, self)) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">when tok.type = "tok" /\ (color = "black" \/ tok.q + counter # 0 \/ tok.color = "black");</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">network := passMsg(network, self, tok, N-1, [type|-> "tok", q |-> 0, color |-> "white"]);</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">            </span></span><span style="--0:#d6deeb;--1:#403f53">color := "white";</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">********)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">\* BEGIN TRANSLATION (chksum(pcal) = "4d658e04" /\ chksum(tla) = "530581e3")</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">VARIABLE network</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">(* define statement *)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">passMsg(net, from, oldMsg, to, newMsg) == [ net EXCEPT ![from] = BagRemove(@, oldMsg), ![to] = BagAdd(@, newMsg) ]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sendMsg(net, to, msg) == [ net EXCEPT ![to] = BagAdd(@, msg) ]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">dropMsg(net, to, msg) == [ net EXCEPT ![to] = BagRemove(@, msg) ]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">pendingMsgs(net, rcv) == DOMAIN net[rcv]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">VARIABLES active, color, counter</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">vars == &#x3C;&#x3C; network, active, color, counter >></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ProcSet == (Node)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">Init == (* Global variables *)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">/\ network = [n \in Node |-> IF n = Initiator THEN SetToBag({[type|-> "tok", q |-> 0, color |-> "black"]}) ELSE EmptyBag]</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">(* Process node *)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">/\ active \in [Node -> BOOLEAN]</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">/\ color = [self \in Node |-> "black"]</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">/\ counter = [self \in Node |-> 0]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">node(self) == \/ /\ active[self]</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ \E to \in Node \ {self}:</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">network' = sendMsg(network, to, [type|-> "pl"])</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ counter' = [counter EXCEPT ![self] = counter[self] + 1]</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ UNCHANGED &#x3C;&#x3C;active, color>></span></div></div><div class="ec-line" style="--ecIndent:14ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">              </span></span><span style="--0:#d6deeb;--1:#403f53">\/ /\ \E msg \in pendingMsgs(network, self):</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ msg.type = "pl"</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ counter' = [counter EXCEPT ![self] = counter[self] - 1]</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ active' = [active EXCEPT ![self] = TRUE]</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ color' = [color EXCEPT ![self] = "black"]</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ network' = dropMsg(network, self, msg)</span></div></div><div class="ec-line" style="--ecIndent:14ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">              </span></span><span style="--0:#d6deeb;--1:#403f53">\/ /\ active' = [active EXCEPT ![self] = FALSE]</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ UNCHANGED &#x3C;&#x3C;network, color, counter>></span></div></div><div class="ec-line" style="--ecIndent:14ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">              </span></span><span style="--0:#d6deeb;--1:#403f53">\/ /\ self # Initiator</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ \E tok \in pendingMsgs(network, self):</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ tok.type = "tok" /\ ~active[self]</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ network' = passMsg(network, self, tok, self-1, [type|-> "tok", q |-> tok.q + counter[self], color |-> (IF color[self] = "black" THEN "black" ELSE tok.color)])</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ color' = [color EXCEPT ![self] = "white"]</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ UNCHANGED &#x3C;&#x3C;active, counter>></span></div></div><div class="ec-line" style="--ecIndent:14ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">              </span></span><span style="--0:#d6deeb;--1:#403f53">\/ /\ self = Initiator</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ \E tok \in pendingMsgs(network, self):</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ tok.type = "tok" /\ (color[self] = "black" \/ tok.q + counter[self] # 0 \/ tok.color = "black")</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ network' = passMsg(network, self, tok, N-1, [type|-> "tok", q |-> 0, color |-> "white"])</span></div></div><div class="ec-line" style="--ecIndent:22ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                      </span></span><span style="--0:#d6deeb;--1:#403f53">/\ color' = [color EXCEPT ![self] = "white"]</span></div></div><div class="ec-line" style="--ecIndent:17ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">                 </span></span><span style="--0:#d6deeb;--1:#403f53">/\ UNCHANGED &#x3C;&#x3C;active, counter>></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">Next == (\E self \in Node: node(self))</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">Spec == /\ Init /\ [][Next]_vars</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">/\ \A self \in Node : WF_vars(node(self))</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">\* END TRANSLATION</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">-----------------------------------------------------------------------------</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">token ==</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">LET tpos == CHOOSE i \in Node : \E m \in DOMAIN network[i]: m.type = "tok"</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">tok == CHOOSE m \in DOMAIN network[tpos] : m.type = "tok"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">IN [pos |-> tpos, q |-> tok.q, color |-> tok.color]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">pending ==</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">[n \in Node |-> IF [type|->"pl"] \in DOMAIN network[n] THEN network[n][[type|->"pl"]] ELSE 0]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">EWD998 == INSTANCE EWD998</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">EWD998Spec == EWD998!Init /\ [][EWD998!Next]_EWD998!vars \* Not checking liveness because we cannot easily define fairness for what ewd998 calls system actions.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">THEOREM Spec => EWD998Spec</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">-----------------------------------------------------------------------------</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">Alias ==</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">[</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">network |-> network,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">active |-> active,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">color |-> color,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">counter |-> counter,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">token |-> token,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">pending |-> pending</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">StateConstraint ==</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">\A i \in DOMAIN counter : counter[i] &#x3C; 3</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">=============================================================================</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="------------------------------- MODULE EWD998PCal -------------------------------(***************************************************************************)(* TLA+ specification of an algorithm for distributed termination          *)(* detection on a ring, due to Shmuel Safra, published as EWD 998:         *)(* Shmuel Safra&#x27;s version of termination detection.                        *)(* https://www.cs.utexas.edu/users/EWD/ewd09xx/EWD998.PDF                  *)(***************************************************************************)EXTENDS Integers, Bags, BagsExtCONSTANT NASSUME NAssumption == N \in Nat \ {0} \* At least one node.Node == 0 .. N-1Initiator == 0 \* Any node can be the initiator; 0 has just been conveniently choosen to simplify the definition of token initiation.(********--algorithm ewd998 {  variables    (*        Although we know the relationship between the counter and network, modeling network as a set of messages would be too cumbersome.        We have two alternatives for modeling the network: as a bag of messages or as a sequence of messages. Although modeling it as a        sequence may seem more intuitive, we do not require its ordering properties for our purposes. Therefore, we have decided to use a        bag to represent the network. It&#x27;s worth noting that Distributed Plucal refers to this concept as a &#x22;channel&#x22;.    *)    network = [n \in Node |-> IF n = Initiator THEN SetToBag({[type|-> &#x22;tok&#x22;, q |-> 0, color |-> &#x22;black&#x22;]}) ELSE EmptyBag];  define {    (*      The passMsg operator is not implementable -at least not without using extra synchronization- because it atomically reads a message      from the nic&#x27;s in-buffer and writes to its out-buffer!    *)    passMsg(net, from, oldMsg, to, newMsg) == [ net EXCEPT ![from] = BagRemove(@, oldMsg), ![to] = BagAdd(@, newMsg) ]    sendMsg(net, to, msg) == [ net EXCEPT ![to] = BagAdd(@, msg) ]    dropMsg(net, to, msg) == [ net EXCEPT ![to] = BagRemove(@, msg) ]    pendingMsgs(net, rcv) == DOMAIN net[rcv]  }  fair process (node \in Node)    variables active \in BOOLEAN, color = &#x22;black&#x22;, counter = 0;  {l:  while (TRUE) {      either { \* send some payload message to some other node.        when active;        with (to \in Node \ {self}) {          network := sendMsg(network, to, [type|-> &#x22;pl&#x22;]);        };        counter := counter + 1      } or { \* receive a payload message. Reactivates the node.        with (msg \in pendingMsgs(network, self)) {            when msg.type = &#x22;pl&#x22;;            counter := counter - 1;            active := TRUE;            color := &#x22;black&#x22;;            network := dropMsg(network, self, msg)        }      } or { \* terminate the current node.        active := FALSE      } or { \* pass the token to the next node.        when self # Initiator;        with (tok \in pendingMsgs(network, self)) {            when tok.type = &#x22;tok&#x22; /\ ~active;            network := passMsg(network, self, tok, self-1, [type|-> &#x22;tok&#x22;, q |-> tok.q + counter, color |-> (IF color = &#x22;black&#x22; THEN &#x22;black&#x22; ELSE tok.color)]);            color := &#x22;white&#x22;;        }      } or { \* Initiate token.        when self = Initiator;        with (tok \in pendingMsgs(network, self)) {            when tok.type = &#x22;tok&#x22; /\ (color = &#x22;black&#x22; \/ tok.q + counter # 0 \/ tok.color = &#x22;black&#x22;);            network := passMsg(network, self, tok, N-1, [type|-> &#x22;tok&#x22;, q |-> 0, color |-> &#x22;white&#x22;]);            color := &#x22;white&#x22;;        }      }    }  }}********)\* BEGIN TRANSLATION (chksum(pcal) = &#x22;4d658e04&#x22; /\ chksum(tla) = &#x22;530581e3&#x22;)VARIABLE network(* define statement *)passMsg(net, from, oldMsg, to, newMsg) == [ net EXCEPT ![from] = BagRemove(@, oldMsg), ![to] = BagAdd(@, newMsg) ]sendMsg(net, to, msg) == [ net EXCEPT ![to] = BagAdd(@, msg) ]dropMsg(net, to, msg) == [ net EXCEPT ![to] = BagRemove(@, msg) ]pendingMsgs(net, rcv) == DOMAIN net[rcv]VARIABLES active, color, countervars == << network, active, color, counter >>ProcSet == (Node)Init == (* Global variables *)        /\ network = [n \in Node |-> IF n = Initiator THEN SetToBag({[type|-> &#x22;tok&#x22;, q |-> 0, color |-> &#x22;black&#x22;]}) ELSE EmptyBag]        (* Process node *)        /\ active \in [Node -> BOOLEAN]        /\ color = [self \in Node |-> &#x22;black&#x22;]        /\ counter = [self \in Node |-> 0]node(self) == \/ /\ active[self]                 /\ \E to \in Node \ {self}:                      network&#x27; = sendMsg(network, to, [type|-> &#x22;pl&#x22;])                 /\ counter&#x27; = [counter EXCEPT ![self] = counter[self] + 1]                 /\ UNCHANGED <<active, color>>              \/ /\ \E msg \in pendingMsgs(network, self):                      /\ msg.type = &#x22;pl&#x22;                      /\ counter&#x27; = [counter EXCEPT ![self] = counter[self] - 1]                      /\ active&#x27; = [active EXCEPT ![self] = TRUE]                      /\ color&#x27; = [color EXCEPT ![self] = &#x22;black&#x22;]                      /\ network&#x27; = dropMsg(network, self, msg)              \/ /\ active&#x27; = [active EXCEPT ![self] = FALSE]                 /\ UNCHANGED <<network, color, counter>>              \/ /\ self # Initiator                 /\ \E tok \in pendingMsgs(network, self):                      /\ tok.type = &#x22;tok&#x22; /\ ~active[self]                      /\ network&#x27; = passMsg(network, self, tok, self-1, [type|-> &#x22;tok&#x22;, q |-> tok.q + counter[self], color |-> (IF color[self] = &#x22;black&#x22; THEN &#x22;black&#x22; ELSE tok.color)])                      /\ color&#x27; = [color EXCEPT ![self] = &#x22;white&#x22;]                 /\ UNCHANGED <<active, counter>>              \/ /\ self = Initiator                 /\ \E tok \in pendingMsgs(network, self):                      /\ tok.type = &#x22;tok&#x22; /\ (color[self] = &#x22;black&#x22; \/ tok.q + counter[self] # 0 \/ tok.color = &#x22;black&#x22;)                      /\ network&#x27; = passMsg(network, self, tok, N-1, [type|-> &#x22;tok&#x22;, q |-> 0, color |-> &#x22;white&#x22;])                      /\ color&#x27; = [color EXCEPT ![self] = &#x22;white&#x22;]                 /\ UNCHANGED <<active, counter>>Next == (\E self \in Node: node(self))Spec == /\ Init /\ [][Next]_vars        /\ \A self \in Node : WF_vars(node(self))\* END TRANSLATION-----------------------------------------------------------------------------token ==    LET tpos == CHOOSE i \in Node : \E m \in DOMAIN network[i]: m.type = &#x22;tok&#x22;        tok == CHOOSE m \in DOMAIN network[tpos] : m.type = &#x22;tok&#x22;    IN [pos |-> tpos, q |-> tok.q, color |-> tok.color]pending ==    [n \in Node |-> IF [type|->&#x22;pl&#x22;] \in DOMAIN network[n] THEN network[n][[type|->&#x22;pl&#x22;]] ELSE 0]EWD998 == INSTANCE EWD998EWD998Spec == EWD998!Init /\ [][EWD998!Next]_EWD998!vars \* Not checking liveness because we cannot easily define fairness for what ewd998 calls system actions.THEOREM Spec => EWD998Spec-----------------------------------------------------------------------------Alias ==    [        network |-> network,        active |-> active,        color |-> color,        counter |-> counter,        token |-> token,        pending |-> pending    ]StateConstraint ==    \A i \in DOMAIN counter : counter[i] < 3============================================================================="><div></div></button></div></figure></div>
<h2 id="script">Script</h2>
<p>The following GenAI script will lint the TLA+ spec above.  More specifically, it will check if the prose comments in the spec are consistent with the TLA+ definitions.</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">tlAI-Linter.genai.js</span></figcaption><pre tabindex="0" class="wrap" style="--ecMaxLine:275ch"><code><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// metadata (including model parameters)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// learn more at https://aka.ms/genaiscript</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">script</span><span style="--0:#D6DEEB;--1:#403F53">({ title: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">tlAI-Linter</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, description: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Check if the prose comments and their TLA+ declarations and definitions are syntactically and semantically consistent</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> })</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// use def to emit LLM variables</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">def</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">TLA+</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">env</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#FAF39F;--1:#111111">files</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">filter</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">f</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">f</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#FAF39F;--1:#111111">filename</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">endsWith</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">.tla</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)), {lineNumbers: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// use $ to output formatted text to the prompt</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">$</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">You are an expert at TLA+/TLAPLUS. Your task is to check if the prose comments and their TLA+ declarations and definitions are syntactically and semantically consistent!!!</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">Explain any consistencies and inconsistencies you may find.  Report inconsistent and consistent pairs in a single ANNOTATION section.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">## TLA+ Syntax Hints</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- A formula [A]_v is called a temporal formula, and is shorthand for the formula A </span><span style="--0:#F78C6C;--1:#AA0982">\/</span><span style="--0:#ECC48D;--1:#3C63B3"> v' = v.  In other words, the formula is true if A is true or if the value of v remains unchanged.  Usually v is a tuple of the spec's variables.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- The symbol </span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">#</span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3"> is alternative syntax used for inequality in TLA+; the other symbol is </span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">/=</span><span style="--0:#F78C6C;--1:#AA0982">\"</span><span style="--0:#ECC48D;--1:#3C63B3">.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">## TLA+ Semantics Hints</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- Do NOT add any invariants or properties to the behavior specification Spec or any of its subformulas.  This would change THEOREM Spec => Inv into THEOREM Spec /</span><span style="--0:#F78C6C;--1:#AA0982">\ </span><span style="--0:#ECC48D;--1:#3C63B3">Inv => Inv, which is vacuously true.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- TLA+ specs are always stuttering insensitive, i.e., the next-state relation is always [A]_v.  In other words, one cannot write a stuttering sensitive specification.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">## TLA+ Convention Hints</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- The type correctness invariant is typically called TypeOK.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- Users can employ TLA labels as a means to conceptually associate a comment with a sub-formula like a specific disjunct or conjunct of a TLA formula. Even though these labels have no other function, they facilitate referencing particular parts of the formula from a comment.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">## Formal and informal math Hints</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3C63B3">- Take into account that humans may write informal math that is syntactically different from the formal math, yet semantically equivalent.  For example, humans may write </span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">N > 3T</span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3"> instead of </span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">N > 3 * T</span><span style="--0:#F78C6C;--1:#AA0982">\`</span><span style="--0:#ECC48D;--1:#3C63B3">.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// metadata (including model parameters)// learn more at https://aka.ms/genaiscriptscript({ title: &#x22;tlAI-Linter&#x22;, description: &#x22;Check if the prose comments and their TLA+ declarations and definitions are syntactically and semantically consistent&#x22; })// use def to emit LLM variablesdef(&#x22;TLA+&#x22;, env.files.filter(f => f.filename.endsWith(&#x22;.tla&#x22;)), {lineNumbers: true})// use $ to output formatted text to the prompt$&#x60;You are an expert at TLA+/TLAPLUS. Your task is to check if the prose comments and their TLA+ declarations and definitions are syntactically and semantically consistent!!!Explain any consistencies and inconsistencies you may find.  Report inconsistent and consistent pairs in a single ANNOTATION section.## TLA+ Syntax Hints- A formula [A]_v is called a temporal formula, and is shorthand for the formula A \/ v&#x27; = v.  In other words, the formula is true if A is true or if the value of v remains unchanged.  Usually v is a tuple of the spec&#x27;s variables.- The symbol \&#x60;#\&#x60; is alternative syntax used for inequality in TLA+; the other symbol is \&#x60;/=\&#x22;.## TLA+ Semantics Hints- Do NOT add any invariants or properties to the behavior specification Spec or any of its subformulas.  This would change THEOREM Spec => Inv into THEOREM Spec /\ Inv => Inv, which is vacuously true.- TLA+ specs are always stuttering insensitive, i.e., the next-state relation is always [A]_v.  In other words, one cannot write a stuttering sensitive specification.## TLA+ Convention Hints- The type correctness invariant is typically called TypeOK.- Users can employ TLA labels as a means to conceptually associate a comment with a sub-formula like a specific disjunct or conjunct of a TLA formula. Even though these labels have no other function, they facilitate referencing particular parts of the formula from a comment.## Formal and informal math Hints- Take into account that humans may write informal math that is syntactically different from the formal math, yet semantically equivalent.  For example, humans may write \&#x60;N > 3T\&#x60; instead of \&#x60;N > 3 * T\&#x60;.&#x60;"><div></div></button></div></figure></div>
<ul>
<li>line numbers are added to the file content to help the LLM precisely locate the issues.</li>
</ul>
<div class="expressive-code"><link rel="stylesheet" href="/genaiscript/_astro/ec.pjkke.css"/><script type="module" src="/genaiscript/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0" class="wrap" style="--ecMaxLine:84ch" dir="ltr"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">def</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">&quot;</span><span style="--0:#ECC48D;--1:#9B504E">TLA+</span><span style="--0:#D9F5DD;--1:#111111">&quot;</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">env</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#FAF39F;--1:#111111">files</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">filter</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">f</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8D46B4">=&gt;</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">f</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#FAF39F;--1:#111111">filename</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">endsWith</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">&quot;</span><span style="--0:#ECC48D;--1:#9B504E">.tla</span><span style="--0:#D9F5DD;--1:#111111">&quot;</span><span style="--0:#D6DEEB;--1:#403F53">)), {</span><mark><span style="--0:#D6DEEB;--1:#403F53">lineNumbers</span></mark><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def(&#34;TLA+&#34;, env.files.filter(f => f.filename.endsWith(&#34;.tla&#34;)), {lineNumbers: true})"><div></div></button></div></figure></div>
<ul>
<li>the script uses a builtin support for <a href="/genaiscript/reference/scripts/annotations">annotations</a>
to generate parseable warnings and errors. Annotations are automatically integrated as problems
in VSCode or as build errors in the CI/CD pipeline.</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0" dir="ltr"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">$</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Report inconsistent and consistent pairs in a single ANNOTATION section.</span><span style="--0:#D6DEEB;--1:#403F53">`</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$`Report inconsistent and consistent pairs in a single ANNOTATION section.`"><div></div></button></div></figure></div>
<ul>
<li>GPT-4 already knows a lot about logic and basic math.  However, the script also lists common TLA+ idioms that are relevant to lint a spec.</li>
</ul>
<h2 id="github-action">Github Action</h2>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">PR.yml</span></figcaption><pre tabindex="0" class="wrap" style="--ecMaxLine:137ch"><code><div class="ec-line"><div class="code"><span style="--0:#7FDBCA;--1:#111111">name</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">tlAI-linter</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF5874;--1:#A54A4A">on</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#111111">pull_request</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#111111">branches</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">- </span><span style="--0:#ECC48D;--1:#3C63B3">master</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#7FDBCA;--1:#111111">jobs</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#111111">linting</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#111111">name</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">tlAI-linter</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#111111">runs-on</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">ubuntu-latest</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#111111">env</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#809191;--1:#616671">## https://microsoft.github.io/genaiscript/reference/token/</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#111111">OPENAI_API_KEY</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">${{ secrets.OPENAI_API_KEY }}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#111111">OPENAI_API_BASE</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">${{ secrets.OPENAI_API_BASE }}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#111111">OPENAI_API_TYPE</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">${{ secrets.OPENAI_API_TYPE }}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#111111">defaults</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#111111">run</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">shell</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">bash</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#111111">steps</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">- </span><span style="--0:#7FDBCA;--1:#111111">name</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">Clone repo</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">uses</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">actions/checkout@v4</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">with</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent">            </span><span style="--0:#809191;--1:#616671">## All history for git diff below to succeed.</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent">            </span><span style="--0:#7FDBCA;--1:#111111">fetch-depth</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#F78C6C;--1:#AA0982">0</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">- </span><span style="--0:#7FDBCA;--1:#111111">name</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">Setup NodeJS</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#809191;--1:#616671">## https://github.com/actions/setup-node</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">uses</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">actions/setup-node@v4</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">with</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent">            </span><span style="--0:#7FDBCA;--1:#111111">node-version</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">20</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">- </span><span style="--0:#7FDBCA;--1:#111111">name</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">Run GenAIscript on the TLA+ specs that are added in this pull request.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#809191;--1:#616671">## Identify git diff: $(git diff --name-only HEAD^ | grep '.tla')</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#809191;--1:#616671">## Install genaiscript runtime: https://microsoft.github.io/genaiscript/reference/cli/</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#809191;--1:#616671">## Output LLM response in SARIF format: https://microsoft.github.io/genaiscript/reference/scripts/annotations/</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">run</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">npx --yes genaiscript run .github/scripts/tlAI-Linter.genai.js $(git diff --name-only HEAD^ | grep '.tla') -oa results.sarif</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line" style="--ecIndent:6ch"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">- </span><span style="--0:#7FDBCA;--1:#111111">name</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">Upload SARIF file</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#809191;--1:#616671">## https://sarifweb.azurewebsites.net</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#809191;--1:#616671">## https://docs.github.com/en/code-security/code-scanning/integrating-with-code-scanning/uploading-a-sarif-file-to-github</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">if</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">success() || failure()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">uses</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">github/codeql-action/upload-sarif@v3</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#111111">with</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="code"><span class="indent">            </span><span style="--0:#7FDBCA;--1:#111111">sarif_file</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#ECC48D;--1:#3C63B3">results.sarif</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="name: tlAI-linteron:  pull_request:    branches:      - masterjobs:  linting:    name: tlAI-linter    runs-on: ubuntu-latest    env:      ## https://microsoft.github.io/genaiscript/reference/token/      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}      OPENAI_API_BASE: ${{ secrets.OPENAI_API_BASE }}      OPENAI_API_TYPE: ${{ secrets.OPENAI_API_TYPE }}    defaults:      run:        shell: bash    steps:      - name: Clone repo        uses: actions/checkout@v4        with:            ## All history for git diff below to succeed.            fetch-depth: 0      - name: Setup NodeJS        ## https://github.com/actions/setup-node        uses: actions/setup-node@v4        with:            node-version: &#x22;20&#x22;      - name: Run GenAIscript on the TLA+ specs that are added in this pull request.        ## Identify git diff: $(git diff --name-only HEAD^ | grep &#x27;.tla&#x27;)        ## Install genaiscript runtime: https://microsoft.github.io/genaiscript/reference/cli/        ## Output LLM response in SARIF format: https://microsoft.github.io/genaiscript/reference/scripts/annotations/        run: npx --yes genaiscript run .github/scripts/tlAI-Linter.genai.js $(git diff --name-only HEAD^ | grep &#x27;.tla&#x27;) -oa results.sarif      - name: Upload SARIF file        ## https://sarifweb.azurewebsites.net        ## https://docs.github.com/en/code-security/code-scanning/integrating-with-code-scanning/uploading-a-sarif-file-to-github        if: success() || failure()        uses: github/codeql-action/upload-sarif@v3        with:            sarif_file: results.sarif"><div></div></button></div></figure></div>
<ul>
<li>
<p>after cloning the repository and installing dependencies such as node.js, the GenAI script is run to lint the TLA+ specs that were added or modified in the PR.</p>
</li>
<li>
<p>the script’s output, i.e., the annotations generated by the LLM, are formatted as a <a href="https://sarifweb.azurewebsites.net">SARIF</a> report and <a href="https://docs.github.com/en/code-security/code-scanning/integrating-with-code-scanning/uploading-a-sarif-file-to-github">upload</a> to the PR.</p>
</li>
</ul>
<h2 id="results">Results</h2>
<p>The linter generated annotations for each prose comment in the spec, and one comment is found to be inconsistent with the TLA+ definitions.  A corresponding warning is added to the PR.</p>
<img src="/genaiscript/_astro/tla-ai-linter.dAaHdzDv_Z1JVyxd.webp" alt="The image shows a screenshot of a GitHub pull request page. The pull request is titled &#34;Update EDW998PCal.tla #1&#34; and is from a branch named &#34;lemmy-patch-1&#34; into the &#34;master&#34; branch. A bot identified as &#34;github-advanced-security&#34; has flagged potential problems 25 minutes ago. Below, part of a file is shown with a diff view highlighting changes between two versions. Two lines have been altered, where an &#34;ASSUME&#34; statement's comment has been updated from &#34;At least one node&#34; to &#34;Any number of nodes between zero and infinitely many.&#34; There's an alert from the TLA+ Linter indicating that the comment is consistent with the TLA+ declaration `N \in Nat \ {0}` which means N is a natural number excluding zero.

Below this, there is a dismissible alert box titled &#34;Check notice&#34; with a &#34;Dismiss alert&#34; button. At the bottom of the screenshot, there's a note that &#34;Some checks were not successful,&#34; indicating 1 successful check and 1 failing check. The successful check is by &#34;TLA-linter / TLA-linter (pull_request)&#34; and the failing check is &#34;Code scanning results / genaiscript.&#34; There's also a reference to a commit push action to the &#34;master&#34; branch from another branch and a prompt suggesting to add more commits by pushing to the &#34;lemmy-patch-1&#34; branch on &#34;lemmy/Examples&#34;." width="1822" height="1750" loading="lazy" decoding="async"> </div> <footer>
Built with 💗 by Microsoft |
<a href="https://go.microsoft.com/fwlink/?LinkId=521839" target="_blank" rel="noopener noreferrer">Privacy &amp; Cookies</a>
| <a href="https://www.microsoft.com/en-us/legal/intellectualproperty/copyright" target="_blank" rel="noopener noreferrer">Terms of Use</a>
| <a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general" target="_blank" rel="noopener noreferrer">Trademarks</a> </footer> </div> </div>   </main> </div> </div>  </div> </div>  </body></html>